machine:
  environment:
    PG_URL: postgres://ubuntu@localhost/mvambot-test
    TEST_PG_URL: postgres://ubuntu@localhost/mvambot-test

dependencies:
  cache_directories:
    - "crystal-0.17.3-1"
  pre:
    - if [[ ! -e crystal-0.17.3-1 ]]; then wget https://github.com/crystal-lang/crystal/releases/download/0.17.3/crystal-0.17.3-1-linux-x86_64.tar.gz && tar xvfz crystal-0.17.3-1-linux-x86_64.tar.gz; fi
    - sudo ln -ns /home/ubuntu/mvam-chatbot/crystal-0.17.3-1/bin/crystal /usr/local/bin/crystal

test:
  pre:
    - crystal deps
    - createdb mvambot-test
    - ./bin/micrate up
    - psql mvambot-test < ./spec/db/seeds.sql
  override:
    - crystal spec
