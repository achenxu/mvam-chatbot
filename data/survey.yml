states:

  ask_age:
    initial: true
    say: How old are you?
    transitions:
      - entity: number
        target: ask_gender
        store: age
      - intent: AskWhy
        target: why
      - intent: AskWho
        target: who

  ask_gender:
    say: Are you a man or a woman?
    transitions:
      - entity: gender
        target: geolocate_user
        store: gender
      - intent: AskWhy
        target: why
      - intent: AskWho
        target: who

  geolocate_user:
    dummy: true
    transitions:
      - method: store_user_location
        target: ask_enough_food
      - default: true
        target: ask_gps
  
  ask_gps:
    say: Would you mind sharing your current position with us?
    options:
      - text: Sure
        request_location: true
      - text: Not really
    transitions:
      - location: true
        target: ask_enough_food
      - default: true
        target: ask_country

  ask_country:
    say: What country do you live in?
    options_from: country_names
    transitions:
      - message_from: country_names
        store: country_name
        target: ask_location_name
      - default: true
        target: ask_enough_food


  ask_location_name:
    say: What's the name of your nearest city?
    transitions:
      - entity: location
        store: location_name
        target: geocode
      - default: true
        target: ask_enough_food

  geocode:
    dummy: true
    transitions:
      - method: geocode_ok
        target: ask_enough_food
      - method: geocode_multiple_results
        target: ask_which_location
      - default: true
        target: ask_enough_food

  ask_which_location:
    say: Is any of these places near you?
    options_from: geocoding_result
    transitions:
      - method: store_chosen_location_coordinates
        target: ask_enough_food
      - default: true
        target: ask_enough_food


  ask_enough_food:
    say: In the past seven days, were there days in which you did not have enough food or money to buy food?
    options:
      - text: Yes
      - text: No
    transitions:
      - target: ask_roof_photo
        message: ["Yes", "No"]
        store: enough_food
      - target: ask_roof_photo
        intent: AnswerNo
        store: enough_food
      - target: ask_roof_photo
        intent: AnswerYes
        store: enough_food

  ask_roof_photo:
    say: Would you please send me a picture of your roof?
    transitions:
      - target: thank_you
        photo: true
        store: roof_photo
      - target: thank_you
        say: No problem
        intent: AnswerNo
      - target: none
        intent: AnswerYes

  thank_you:
    say: That would be all, thank you for your answers!
    final: true

  why:
    say: We are asking you and other people in your community this information because we are tracking food security in your region.
    transient: true
    transitions:
      - target: back
        after: 5
      - target: back
        intent: AnswerYes
      - intent: AskWho
        target: who

  who:
    say: I am a WFP bot assistant, for tracking food security in your region.
    transient: true
    transitions:
      - target: back
        after: 5
      - intent: AskWhy
        target: why
      - target: back
        intent: AnswerYes

data:
  - age
  - gender
  - enough_food
  - roof_photo
  - lat
  - lng
  - location_name
  - country_name

# deprecated:
#
#   hello:
#     actions:
#       - say: Hi, I'm a WFP bot assistant, I'd like to ask you a few questions if you have a minute.
#     transitions:
#       - intent: AnswerYes
#         target: ask_age
#       - intent: AnswerNo
#         target: survey_no
#
#   survey_no:
#     actions:
#       - say: Would you be available later? It is just a minute.
#     transitions:
#       - entity: { survey_at: wit/datetime }
#         target: rescheduled
#       - intent: AnswerYes
#         target: reschedule
#       - intent: AnswerNo
#         target: no_reschedule
#
#   reschedule:
#     actions:
#       - say: When can I bother you?
#     transitions:
#       - entity: { survey_at: wit/datetime }
#         target: rescheduled
#       - intent: AnswerNo
#         target: no_reschedule
#
#   rescheduled:
#     actions:
#       - say: Great, I'll talk to you then. Thank you!
#
#   no_reschedule:
#     actions:
#       - say: OK, sorry to hear that. Just say "hello" any time if you change your mind!
