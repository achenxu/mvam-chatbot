survey_data:
  - age
  - gender
  - enough_food
  - roof_photo

common_transitions:
  - intent: AskWhy
    target: why
  - intent: AskWho
    target: who

states:

  start:
    initial: true
    say: I would like to ask you a few questions if you have a minute.
    transitions:
      - entity: yes_no
        value: Yes
        target: ask_age
      - entity: yes_no
        value: No
        target: check_availability

  check_availability:
    say: Would you be available later? It will take just a minute.
    transitions:
      - entity: yes_no
        value: Yes
        target: ask_availability
      - entity: yes_no
        value: No
        target: no_survey
      - entity: wit/datetime
        store: survey_at
        target: reschedule_survey

  ask_availability:
    say: When would you be available?
    transitions:
      - entity: wit/datetime
        store: survey_at
        target: reschedule_survey

  reschedule_survey:
    say: Great, thanks! I'll talk to you then.
    final: true

  no_survey:
    say: That's ok. Just say "hello" any time if you change your mind!
    final: true

  ask_age:
    initial: true
    say: How old are you?
    transitions:
      - entity: number
        target: ask_gender
        store: age

  ask_gender:
    say: Are you a man or a woman?
    transitions:
      - entity: gender
        target: ask_enough_food
        store: gender

  ask_enough_food:
    say: In the past seven days, were there days in which you did not have enough food or money to buy food?
    options:
      - Yes
      - No
    transitions:
      - target: ask_roof_photo
        message: ["Yes", "No"]
        store: enough_food
      - target: ask_roof_photo
        entity: yes_no
        store: enough_food

  ask_roof_photo:
    say: Would you please send me a picture of your roof?
    transitions:
      - target: thank_you
        photo: true
        store: roof_photo
      - target: thank_you
        say: No problem
        entity: yes_no
        value: No
      - target: none
        entity: yes_no
        value: Yes

  thank_you:
    say: That would be all, thank you for your answers!
    final: true

  why:
    say: We are asking you and other people in your community this information because we are tracking food security in your region.
    transient: true
    transitions:
      - target: back
        after: 5
      - target: back
        entity: yes_no
        value: Yes

  who:
    say: I am a WFP bot assistant, for tracking food security in your region.
    transient: true
    transitions:
      - target: back
        after: 5
      - target: back
        entity: yes_no
        value: Yes
