#! /usr/bin/env crystal

require "csv"

require "../src/mvam-bot/models/*"
require "../src/mvam-bot/wit/*"
require "../src/mvam-bot/*"

FILE_PATH = "positions.csv"

def main
  if !File.exists?(FILE_PATH)
    puts "Position mapping file #{FILE_PATH} not found"
    exit 1
  end

  File.open(FILE_PATH, "r") do |file|
    count = 0
    CSV.each_row(file) do |row|
      id, name, country_code, lat, lng = row
      puts "Updating position for location #{id} (#{name})"
      MvamBot::Location::Mkt.set_position(id, lat.to_f, lng.to_f)
      count += 1
    end
    puts "Done! #{count} locations updated."
  end
end

main
